{{- define "type" -}} note wide {{- end -}}

{{ define "links" }}
    <link rel="stylesheet" href="{{ .Site.BaseURL }}css/note.css?v=2.4" media="all">
    <link rel="stylesheet" href="{{ .Site.BaseURL }}css/navigation.css?v=2.4" media="all">
{{ end }}

{{ define "body" }}

{{ partial "header.html" . }}

{{ $courseNumber := ( .Section | humanize | upper ) }}
{{ $courseData := (index (where $.Site.Data.courses "course-number" $courseNumber) 0) }}
{{ $volume := index (.Param "Volumes") 0 }}
{{ $issue := .Param "Issue" }}
{{ $supTitle := (printf "%s, Section %s.%d" $courseNumber $volume $issue) }}

{{ partial "navigation.html" ( dict "supTitle" $supTitle "title" .Title "navigation" (dict) "emphColor" (index $courseData "course-color") ) }}


  <main class="content" role="main">
    <article class="article">
      <div class="article__content">
        <script>
          keywordsCollector = [];
          keywordsCounter = 0;
        </script>
        {{ .Content }}
      </div>
    </article>
    <aside class="navigation--side">
			<div class="navigation--side__selector">
				<button class="navigation--side__button navigation--side__button--active" id="navigation--side__button--section" onclick="navigationSideSwitchToSection()">Section</button>
				<button class="navigation--side__button" id="navigation--side__button--page" onclick="navigationSideSwitchToPage()">Page</button>
        <script>
          function navigationSideSwitchToSection() {
            document.getElementById("page-navigation").setAttribute("style","display: none;");
            document.getElementById("section-navigation").setAttribute("style","display: block;");
            document.getElementById("navigation--side__button--section").classList.add("navigation--side__button--active");
            document.getElementById("navigation--side__button--page").classList.remove("navigation--side__button--active");
          }

          function navigationSideSwitchToPage() {
            document.getElementById("section-navigation").setAttribute("style","display: none;");
            document.getElementById("page-navigation").setAttribute("style","display: block;");
            document.getElementById("navigation--side__button--section").classList.remove("navigation--side__button--active");
            document.getElementById("navigation--side__button--page").classList.add("navigation--side__button--active");
          }
        </script>
			</div>
      <ul class="navigation--side__list" id="section-navigation">
      {{ $uid := .UniqueID }}
      {{ range where $.Site.Pages.Reverse "Section" (.Section | urlize) }}
        {{ $is_section := eq .Kind "section" }}
        {{ $is_hide := and (isset .Params "hide") (.Param "hide") }}
        {{ $is_current := eq .UniqueID $uid }}
        {{ if (not (or $is_hide $is_section)) }}
          {{ if eq .Section ($courseNumber | urlize) }}
            {{ $index := printf "%s.%d" (index (.Param "Volumes") 0) (.Param "Issue") }}
            <li class="navigation--side__item {{ if $is_current }}navigation--side__item--current{{ end }}">
              <a href="/{{ .Section | urlize }}/{{ $index | urlize }}"><span class="navigation--side__index">{{ $index }}</span> {{ .Title }}</a>
            </li>
          {{ end }}
        {{ end }}
      {{ end }}
      </ul>
      <ul class="navigation--side__list" id="page-navigation">
        <script>
          var pageNavigationListDOM = document.getElementById("page-navigation");
          for (var i = 0; i < keywordsCollector.length; i ++) {
            pageNavigationListDOM.appendChild(keywordsCollector[i]);
          }
        </script>
      </ul>
    </aside>
  </main>

  {{ if eq .Kind "page" }}
  <div class="pagination">
    <div class="pagination-wrapper">
      {{ with .PrevInSection }}
        {{ $is_section := eq .Kind "section" }}
        {{ $is_hide := and (isset .Params "hide") (.Param "hide") }}
        {{ if (not (or $is_hide $is_section)) }}
          <a href="{{ .Permalink }}" class="pagination__prev">{{ with .Param "volumes" }}{{ index . 0 }}{{ end }}.{{ with .Param "issue" }}{{ . }}{{ end }} {{ .Title }}</a>
        {{ end }}
      {{ end }}
      {{ with .NextInSection }}
        {{ $is_section := eq .Kind "section" }}
        {{ $is_hide := and (isset .Params "hide") (.Param "hide") }}
        {{ if (not (or $is_hide $is_section)) }}
          <a href="{{ .Permalink }}" class="pagination__next">{{ with .Param "volumes" }}{{ index . 0 }}{{ end }}.{{ with .Param "issue" }}{{ . }}{{ end }} {{ .Title }}</a>
        {{ end }}
      {{ end }}
    </div>
  </div>
  {{ end }}

  {{ partial "scripts.html" . }}

  {{ partial "footer.html" . }}

{{ end }}
